using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.InputSystem;
using UnityEngine.InputSystem.Controls;
/// <summary>
/// inputManager es una clase que mapea los inputs de teclado y mando.
/// </summary>
public class inputManager : MonoBehaviour
{
    /// <summary>
    /// Es el mapeo de string a tecla de teclado.
    /// </summary>
    private static Dictionary<string, KeyCode> _inputList;

    /// <summary>
    /// Es el mapeo de string a botón de gamepad.
    /// </summary>
    private static Dictionary<string, ButtonControl> _inputListgamepad;

    /// <summary>
    /// Establece si hay o no un dispositivo conectado.
    /// </summary>
    private static bool _deviceIsConnected = false;


    /// <summary>
    /// Es el primer método que se ejecuta al iniciar el script.
    /// Asigna en <see cref="_inputList"/> una tecla a cada string y comprueba si hay un gamepad para asignar sus controles.
    /// </summary>
    private void Awake()
    {
        _inputList = new Dictionary<string, KeyCode>();

        _inputList.Add("Jump", KeyCode.Space);
        _inputList.Add("Right", KeyCode.RightArrow);
        _inputList.Add("Left", KeyCode.LeftArrow);
        _inputList.Add("Down", KeyCode.S);
        _inputList.Add("Up", KeyCode.W);
        _inputList.Add("PrimaryAttack", KeyCode.Mouse0);
        _inputList.Add("SecundaryAttack", KeyCode.Mouse1);
        _inputList.Add("ShowMinimap", KeyCode.Tab);
        _inputList.Add("Roll", KeyCode.R);
        _inputList.Add("Pause", KeyCode.Escape);
        _inputList.Add("Interact", KeyCode.E);
        _inputList.Add("Previous", KeyCode.J);
        _inputList.Add("Next", KeyCode.K);
        _inputList.Add("Enter_equip", KeyCode.Return);
        _inputList.Add("Cancel", KeyCode.Escape);
        _inputList.Add("Accept", KeyCode.Return);

        //Si hay un gamepad conectado
        if (Gamepad.current != null)
        {
            changeDeviceConnected();
            createGamepadDefaultInputs();
        }
    }
    
    /// <summary>
    /// Asigna a un string un botón de gamepad en <see cref="_inputListgamepad"/>.
    /// </summary>
    public static void createGamepadDefaultInputs()
    {
        _inputListgamepad = new Dictionary<string, ButtonControl>();
        _inputListgamepad.Add("Jump", Gamepad.current.buttonSouth);
        _inputListgamepad.Add("Right", Gamepad.current.dpad.right);
        _inputListgamepad.Add("Left", Gamepad.current.dpad.left);
        _inputListgamepad.Add("Down", Gamepad.current.leftStick.down);
        _inputListgamepad.Add("Up", Gamepad.current.leftStick.up);
        _inputListgamepad.Add("PrimaryAttack", Gamepad.current.rightShoulder);
        _inputListgamepad.Add("SecundaryAttack", Gamepad.current.leftShoulder);
        _inputListgamepad.Add("ShowMinimap", Gamepad.current.selectButton);
        _inputListgamepad.Add("Roll", Gamepad.current.buttonEast);
        _inputListgamepad.Add("Pause", Gamepad.current.startButton);
        _inputListgamepad.Add("Interact", Gamepad.current.buttonWest);
        _inputListgamepad.Add("Previous", Gamepad.current.leftTrigger);
        _inputListgamepad.Add("Next", Gamepad.current.rightTrigger);
        _inputListgamepad.Add("Enter_equip", Gamepad.current.buttonSouth);
        _inputListgamepad.Add("Cancel", Gamepad.current.buttonEast);
        _inputListgamepad.Add("Accept", Gamepad.current.buttonSouth);
    }
    
    /// <summary>
    /// Niega la condición de <see cref="_deviceIsConnected"/>
    /// </summary>
    public static void changeDeviceConnected()
    {
        _deviceIsConnected = !_deviceIsConnected;
    }

    public static void changeInput(string ActionName, KeyCode newKey)
    {
        _inputList[ActionName] = newKey; 
    }

    public static void changePadInput(string ActionName, ButtonControl newKey)
    {
        _inputListgamepad[ActionName] = newKey;

    }

    public static bool getKey(string action)
    {
        bool gamepadControl = false;

        if (Gamepad.current != null)
        {
            gamepadControl = getGamepadAction(action).isPressed;
        }

        return Input.GetKey(getAction(action)) || gamepadControl; 
    }
    public static bool getKeyDown(string action)
    {
        bool gamepadControl = false;
        if (Gamepad.current != null)
        {
            gamepadControl = getGamepadAction(action).wasPressedThisFrame;
        }

        return Input.GetKeyDown(getAction(action)) || gamepadControl;
    }
    public static bool getKeyUp(string action)
    {
        bool gamepadControl = false;
        if (Gamepad.current != null)
        {
            gamepadControl = getGamepadAction(action).wasReleasedThisFrame;
        }

        return Input.GetKeyUp(getAction(action)) || gamepadControl;
    }

    public static KeyCode getAction(string actionName)
    {
        return _inputList[actionName];
    }
    public static ButtonControl getGamepadAction(string actionName)
    {
        return _inputListgamepad[actionName];
    }

    public static Dictionary<string, KeyCode> getInputList()
    {
        return _inputList;
    }
    public static Dictionary<string, ButtonControl> getGamepadInputs()
    {
        return _inputListgamepad;
    }
    public static bool getDeviceConnected()
    {
        return _deviceIsConnected;
    }
}
